/*! (C) 2021 Conviva, Inc. All rights reserved. Confidential and proprietary. */

"use strict";videojs.registerPlugin("convivaPlugin",function(n){n.n="BrightcovePlayer",n.i=(bc||videojs).VERSION,new convivaBcIntegration(this,n)});var convivaBcIntegration=function(n,i){var d=this;function o(n,i){(n||void 0!==d.o)&&d.t.playlist&&d.o!==d.t.playlist.currentItem()&&(d.a(i),d.e(i))}function a(n){d.v("Conviva Captured Video Event - - "+n.type)}d.t=n,d.r=i,d.s=null,d.u=null,d.d=null,d.f=-1,d.c=-1,d.C=Conviva.Constants.PlayerState.UNKNOWN,d.l=!1,d.h=!1,d.o=void 0,d.p=!1,d.g=!0,d.y=!1,d.N=!1,d.V=null,d.A=null,d.I=!1,d.w=!1,d.O=!1,d.m=null,d.t.ready(function(){d.M(),d.P(),d.j(),d.t.on("loadstart",d._),d.t.on("firstplay",d.b),d.t.on("play",d.b),d.t.on("playing",d.b),d.t.on("ended",d.B),d.t.on("abort",d.x),d.t.on("dispose",d.R),d.t.on("error",d.S),d.t.on("aderror",d.S),d.t.on("contenterror",d.S),d.t.on("ima3-content-pause-requested",d.k),d.t.on("ima3-content-resume-requested",d.q),d.t.on("ads-ad-started",d.T),d.t.on("ads-request",d.F),d.t.on("adserror",d.U),d.t.on("adtimeout",d.U),d.t.on("ima3-hardtimeout",d.U),d.t.on("ima3error",d.U),d.t.on("ima3-log",d.U),d.t.on("ads-pod-started",d.k),d.t.on("ads-pod-ended",d.q),d.t.on("ads-ad-skipped",d.D),d.t.on("ads-allpods-completed",d.G),d.t.on("ads-ad-ended",d.J),d.t.on("ads-pause",d.H),d.t.on("ads-play",d.K),d.t.on("adsready",d.Y)}),d.M=function(){var n,i;d.r.customerKey?(n=d.r.customerKey,i={},d.r.serviceUrl||d.r.gatewayUrl||d.r.gateway_host?i[Conviva.Constants.GATEWAY_URL]=d.r.serviceUrl||d.r.gatewayUrl||d.r.gateway_host:d.v("gatewayUrl is not present in the plugin configuration"),d.r.toggleTraces&&(i[Conviva.Constants.LOG_LEVEL]=Conviva.Constants.LogLevel.DEBUG),Conviva.Analytics.init(n,null,i),Conviva.Analytics.setDeviceMetadata(d.z()),d.V=new Conviva.Impl.Html5Logging,d.A=new Conviva.Impl.Html5Time):d.v("CUSTOMER_KEY is not present in the plugin configuration!")},d.P=function(){null===d.s&&(window.ConvivaVideoAnalytics=d.s=Conviva.Analytics.buildVideoAnalytics(),d.d?d.d.L(d.t,d.s):"function"==typeof videojsProxy&&(d.d=new videojsProxy(d.t,null,d.s,Conviva,d.v,d.r)))},d.j=function(){var n={};n[Conviva.Constants.MODULE_NAME]="BCC",n[Conviva.Constants.MODULE_VERSION]="4.3.3","boolean"==typeof d.r.enableAdExperience&&d.r.enableAdExperience&&(d.u||(window.ConvivaAdAnalytics=d.u=Conviva.Analytics.buildAdAnalytics(d.s)),d.u.setAdInfo(n))},d.z=function(){var n={};return n[Conviva.Constants.DeviceMetadata.CATEGORY]=Conviva.Constants.DeviceCategory.WEB,n},d._=function(n){a(n),o(!1,n)},d.b=function(n){a(n),o(!0,n)},d.W=function(n){a(n),o(!0,n)},d.S=function(n){var i;a(n),o(!0,n),d.t&&(i=d.t.error(),d.v("MediaError: Type: "+n.type+"; Error Type: "+i.type+", Code: "+i.code+", Message: "+i.message),i&&i.code&&d.s.reportPlaybackError("MediaError: Type: "+n.type+", Error Type: "+i.type+", Code: "+i.code+", Message: "+i.message,Conviva.Constants.ErrorSeverity.FATAL))},d.Q=function(n){!0===d.g&&d.a(n),d.y=!0},d.x=function(n){a(n),d.a(n),d.y=!0},d.B=function(n){a(n),d.Q(n)},d.R=function(n){a(n),d.a(n),d.y=!0},d.G=function(n){a(n),!0===d.y&&d.a(n),d.g=!0},d.T=function(n){a(n),d.t&&d.t.ima3&&d.t.ima3.currentAd&&!d.t.ima3.currentAd.isLinear()||(d.P(),d.j(),n={has_ads_started:"true"},d.s.setContentInfo(n),d.X())},d.F=function(n){a(n),d.t&&d.t.ima3&&d.t.ima3.currentAd&&!d.t.ima3.currentAd.isLinear()||(d.P(),d.j(),n={has_ads_requested:"true"},d.s.setContentInfo(n))},d.U=function(n){a(n);var i="ima3-log"===n.type&&void 0!==n.originalEvent&&"function"==typeof n.originalEvent.getAdData&&n.originalEvent.getAdData().adError;if("ima3-log"!==n.type||i){if(d.t&&d.t.ima3&&d.t.ima3.currentAd&&!d.t.ima3.currentAd.isLinear())return;d.P(),d.j();var o,t={has_ads_error:"true"};d.r.toggleTraces&&(t.adserrorevent=i?n.originalEvent.getAdData().adError.getType():n.type),d.s.setContentInfo(t),d.u&&(t={},i?(n.originalEvent.getAdData().adError.getType()&&(o="Type: "+n.originalEvent.getAdData().adError.getType(),t[Conviva.Constants.ASSET_NAME]=n.originalEvent.getAdData().adError.getType()),n.originalEvent.getAdData().adError.getErrorCode()&&(o?o+=", Code: "+n.originalEvent.getAdData().adError.getErrorCode():o="Code: "+n.originalEvent.getAdData().adError.getErrorCode()),o?o+=", Message: "+n.originalEvent.getAdData().adError.getMessage():o="Message: "+n.originalEvent.getAdData().adError.getMessage()):(n.type&&(o="Type: "+n.type,t[Conviva.Constants.ASSET_NAME]=n.type),n.errorCode&&(o?o+=", Code: "+n.errorCode:o="Code: "+n.errorCode),o?o+=", Message: Ad Request Failed":o="Message: Ad Request Failed"),o=o||"Ad Request Failed",(i={})[Conviva.Constants.FRAMEWORK_NAME]="Brightcove IMA Plugin",i[Conviva.Constants.FRAMEWORK_VERSION]=""+d.t.ima3.VERSION,d.u.setAdPlayerInfo(i),(i=d.Z())&&void 0!==i&&(t[Conviva.Constants.IS_LIVE]=i),t["c3.ad.technology"]="Client Side",d.N?d.u.reportAdFailed(o,t):(d.u.setAdInfo(t),d.m=o))}"adserror"===n.type&&d.q(n)},d.k=function(n){var i;a(n),d.l||(d.v("Conviva Event Handler - - handlePodStarted"),d.I||(d.P(),d.j(),i={has_pod_started:"true"},d.r.toggleTraces&&(i.podstartedevent=n.type),d.s.setContentInfo(i),d.I=!0),d.s.reportAdBreakStarted(Conviva.Constants.AdType.CLIENT_SIDE,Conviva.Constants.AdPlayer.CONTENT,null),d.l=!0,d.g=!1,d.d.C=Conviva.Constants.PlayerState.UNKNOWN)},d.q=function(n){var i;a(n),d.l&&(d.v("Conviva Event Handler - - handlePodEnded"),d.w||(i={has_pod_ended:"true"},d.r.toggleTraces&&(i.podendedevent=n.type),d.s.setContentInfo(i),d.w=!0),d.s.reportAdBreakEnded(),d.l=!1),d.J()},d.K=function(){d.$(),d.u&&d.t&&d.t.ima3&&d.t.ima3.currentAd&&d.t.ima3.currentAd.isLinear()&&d.u.reportAdMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.PLAYING,"CONVIVA")},d.H=function(){d.$(),d.u&&d.t&&d.t.ima3&&d.t.ima3.currentAd&&d.t.ima3.currentAd.isLinear()&&d.u.reportAdMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.PAUSED,"CONVIVA")},d.J=function(){var n;d.t&&d.t.ima3&&d.t.ima3.currentAd&&!d.t.ima3.currentAd.isLinear()||(d.P(),d.s&&(n={has_ads_ended:"true"},d.s.setContentInfo(n)),d.u&&(d.u.reportAdMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.STOPPED,"CONVIVA"),d.u.reportAdEnded()))},d.D=function(){var n;d.t&&d.t.ima3&&d.t.ima3.currentAd&&!d.t.ima3.currentAd.isLinear()||(d.P(),d.s&&(n={has_ads_skipped:"true"},d.s.setContentInfo(n)),d.u&&(d.u.reportAdMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.STOPPED,"CONVIVA"),d.u.reportAdSkipped()))},d.Y=function(){if(google){var n,i=[google.ima.AdEvent.Type.AD_BUFFERING,google.ima.AdEvent.Type.AD_PROGRESS];for(n in i)d.t.ima3.adsManager.addEventListener(i[n],d.nn,!1,d)}},d.nn=function(n){d.t&&d.t.ima3&&d.t.ima3.currentAd&&d.t.ima3.currentAd.isLinear()&&(google&&n.type===google.ima.AdEvent.Type.AD_BUFFERING?(d.$(),d.O=!0,d.u&&d.u.reportAdMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.BUFFERING,"CONVIVA")):google&&n.type===google.ima.AdEvent.Type.AD_PROGRESS&&(d.$(),d.u&&!d.O&&d.u.reportAdMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.PLAYING,"CONVIVA"),d.O=!1))},d.e=function(n){d.N||(d.N=!0,null===d.s&&d.P(),d.s.reportPlaybackRequested(d.in(n)),d.v("Conviva Session Start Event="+n.type),d.h=!0,d.y=!1,d.o=d.t.playlist.currentItem(),d.m&&d.u&&d.u.reportAdFailed(d.m),d.m=null)},d.X=function(){var n;d.u&&d.t&&d.t.ima3&&d.t.ima3.currentAd&&d.t.ima3.currentAd.isLinear()&&((n={})[Conviva.Constants.FRAMEWORK_NAME]="Brightcove IMA Plugin",n[Conviva.Constants.FRAMEWORK_VERSION]=""+d.t.ima3.VERSION,d.u.setAdPlayerInfo(n),n=d.tn(),d.u.reportAdStarted(n),d.u.reportAdMetric(Conviva.Constants.Playback.RESOLUTION,d.t.ima3.currentAd.getVastMediaWidth(),d.t.ima3.currentAd.getVastMediaHeight(),"CONVIVA"),d.u.reportAdMetric(Conviva.Constants.Playback.BITRATE,d.t.ima3.currentAd.getVastMediaBitrate(),"CONVIVA"),d.t.ads.ad.currentTime<=0&&d.u.reportAdMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.BUFFERING,"Conviva"))},d.$=function(){var n;d.u&&d.t&&d.t.ima3&&d.t.ima3.currentAd&&d.t.ima3.currentAd.isLinear()&&((n=d.t.ads.ad.currentTime)<d.t.ads.ad.duration&&(d.u.reportAdMetric(Conviva.Constants.Playback.PLAY_HEAD_TIME,1e3*n,"CONVIVA"),d.u.reportAdMetric(Conviva.Constants.Playback.RESOLUTION,d.t.ima3.currentAd.getVastMediaWidth(),d.t.ima3.currentAd.getVastMediaHeight(),"CONVIVA"),d.u.reportAdMetric(Conviva.Constants.Playback.BITRATE,d.t.ima3.currentAd.getVastMediaBitrate(),"CONVIVA")))},d.tn=function(){var n,i,o,t,a={};return d.t&&d.t.ima3&&d.t.ima3.currentAd&&((t=d.t.ima3.currentAd).getMediaUrl()&&(a[Conviva.Constants.STREAM_URL]=t.getMediaUrl()),t.getTitle()&&(a[Conviva.Constants.ASSET_NAME]=t.getTitle()),t.getDuration()&&0<t.getDuration()&&(a[Conviva.Constants.DURATION]=t.getDuration()),(n=d.Z())&&void 0!==n&&(a[Conviva.Constants.IS_LIVE]=n),a["c3.ad.system"]=t.getAdSystem()?""+t.getAdSystem():"NA",a["c3.ad.isSlate"]=""+!1,a["c3.ad.mediaFileApiFramework"]=t.getApiFramework()?""+t.getApiFramework():"NA",a["c3.ad.creativeId"]=t.getCreativeId()?""+t.getCreativeId():"NA",t=t.getWrapperAdIds()&&0!==t.getWrapperAdIds().length?(n=t.getWrapperAdIds().length,i=t.getWrapperAdSystems()[n-1],o=t.getWrapperAdIds()[n-1],t.getWrapperCreativeIds()[n-1]):(i=t.getAdSystem(),o=t.getAdId(),t.getCreativeId()),a["c3.ad.firstAdSystem"]=i?""+i:"NA",a["c3.ad.firstAdId"]=o?""+o:"NA",a["c3.ad.firstCreativeId"]=t?""+t:"NA"),a["c3.ad.technology"]="Client Side",a["c3.ad.id"]=d.t&&d.t.ads&&d.t.ads.ad&&d.t.ads.ad.id?""+d.t.ads.ad.id:"NA",a["c3.ad.position"]=d.t&&d.t.ads&&d.t.ads.ad&&d.t.ads.ad.type?""+d.t.ads.ad.type:"NA",a},d.in=function(n){var i,o,t={},a=d.r.tags,e=d.r.convivatags;if("undefined"!=typeof Conviva&&Conviva){var v={};if(v[Conviva.Constants.FRAMEWORK_NAME]=d.r.n,v[Conviva.Constants.FRAMEWORK_VERSION]=d.r.i,d.s.setPlayerInfo(v),i="",(o=(v=d.t.playlist&&d.t.playlist()&&0<d.t.playlist().length?d.t.playlist()[d.t.playlist.currentItem()]:d.t.mediainfo)&&(v.custom_fields||v.customFields)?v.custom_fields||v.customFields:o)&&(o.assetName||o.assetname)?i=o.assetName||o.assetname:(v.name&&(i=v.name),v.id&&(i?i+=" - "+v.id:i=v.id,t.ID=v.id)),!i&&d.r&&d.r.assetName&&(i=d.r.assetName),t[Conviva.Constants.ASSET_NAME]=i,i="",o&&(o.viewerId||o.viewerid)&&(i=o.viewerId||o.viewerid,t[Conviva.Constants.VIEWER_ID]=i),!i&&d.r.viewerId&&(t[Conviva.Constants.VIEWER_ID]=d.r.viewerId),d.r.playerName&&(t[Conviva.Constants.PLAYER_NAME]=d.r.playerName),i="",o&&(o.defaultReportingResource||o.defaultreportingresource)&&(i=o.defaultReportingResource||o.defaultreportingresource,t[Conviva.Constants.DEFAULT_RESOURCE]=i),!i&&d.r.defaultReportingResource&&(t[Conviva.Constants.DEFAULT_RESOURCE]=d.r.defaultReportingResource),i="",o&&(o.encodedFramerate||o.encodedframerate)&&(i=o.encodedFramerate||o.encodedframerate,t[Conviva.Constants.ENCODED_FRAMERATE]=parseInt(i,10)),!i&&d.r.encodedFramerate&&(t[Conviva.Constants.ENCODED_FRAMERATE]=parseInt(d.r.encodedFramerate,10)),v&&0<v.duration&&(t[Conviva.Constants.DURATION]=v.duration),(v=d.Z())&&void 0!==v&&(t[Conviva.Constants.IS_LIVE]=v),a)for(var r in a)t[r]=a[r];if(e){var s=e.split(",");if(s&&o)for(var u=0;u<s.length;u++)Object.prototype.hasOwnProperty.call(o,s[u])&&(t[s[u]]=o[s[u]])}}return d.r.toggleTraces&&(t.sessionStartEvent=n.type,d.t&&d.t.playlist&&"function"==typeof d.t.playlist.currentItem&&(t.currentItem=d.t.playlist.currentItem().toString())),window&&window.location&&window.location.href&&(t.href=window.location.href),t},d.Z=function(){var n,i=d.t.playlist&&d.t.playlist()&&0<d.t.playlist().length?d.t.playlist()[d.t.playlist.currentItem()]:d.t.mediainfo,o="",t=null;return(n=i&&(i.custom_fields||i.customFields)?i.custom_fields||i.customFields:n)&&(n.isLive||n.islive)?"true"===(o=n.isLive||n.islive).toLowerCase()?t=Conviva.Constants.StreamType.LIVE:"false"===o.toLowerCase()&&(t=Conviva.Constants.StreamType.VOD):i&&0<i.duration&&(o="false",t=Conviva.Constants.StreamType.VOD),t=!o&&void 0!==d.r.isLive?d.r.isLive?Conviva.Constants.StreamType.LIVE:Conviva.Constants.StreamType.VOD:t},d.v=function(n){var i;d.r.toggleTraces&&d.V&&d.A&&(i=(d.A.getEpochTimeMs()/1e3).toFixed(3).toString(),d.V.consoleLog("[Conviva] ["+i+"] [DEBUG] [SDK] [BrightcoveProxy] "+n,Conviva.SystemSettings.LogLevel.DEBUG))},d.a=function(n){var i;d.s&&(d.v("Brightcove Plugin end current item monitoring"),d.r.toggleTraces&&d.h&&((i={}).sessionEndEvent=n.type,d.s.setContentInfo(i),d.v("Conviva Session End Event="+n.type)),d.s.reportPlaybackEnded(),d.d.cleanup(),d.u&&(d.u.release(),window.ConvivaAdAnalytics=d.u=null),d.s.release(),window.ConvivaVideoAnalytics=d.s=null,d.l=!1,d.h=!1,d.o=null,d.p=!1,d.g=!0,d.y=!1,d.N=!1,d.I=!1,d.w=!1,d.m=null)}},videojsProxy=function(n,i,o,h){var p=this;p.an=[],p.en=0,p.vn=0,p.rn=!1,this.f=-1,this.c=-1,this.C=h.Constants.PlayerState.UNKNOWN,this.h=!1,this.sn=0,this.un=-1,this.dn="",this.fn=null,this.cn=!1,this.Cn=function(n,i,o){void 0===o&&(o=p.ln),p.hn.push([n,i,o]),o.on(n,i)},this.pn=function(n,i,o){(o=void 0===o?p.ln:o).off(n,i)},this.gn=function(){p.Cn("onContentPauseRequested",function(n){p.v("onContentPauseRequested",n)}),p.Cn("onContentResumeRequested",function(n){p.v("onContentResumeRequested",n)}),p.Cn("abort",function(n){p.v("abort",n)}),p.Cn("loadstart",function(n){p.v("loadstart",n)}),p.Cn("firstplay",function(n){p.v("firstplay",n),p.yn(n)}),p.Cn("play",function(n){p.v("play",n),p.yn(n)}),p.Cn("ended",function(n){p.v("ended",n),p.Nn(h.Constants.PlayerState.STOPPED)}),p.Cn("pause",function(n){p.v("pause",n),p.yn(n),p.Nn(h.Constants.PlayerState.PAUSED)}),p.Cn("playing",function(n){p.v("playing",n),p.yn(n),0===p.ln.currentTime()?p.rn=!0:0<p.ln.currentTime()&&(p.rn=!1)}),p.Cn("waiting",function(n){p.v("waiting",n),p.yn(n),p.Nn(h.Constants.PlayerState.BUFFERING)}),p.Cn("timeupdate",function(){p.rn&&(p.en++,p.C!==h.Constants.PlayerState.PLAYING&&p.ln&&!p.ln.seeking()&&p.Nn(h.Constants.PlayerState.PLAYING))}),p.Cn("error",function(n){p.Vn(n)}),p.Cn("contenterror",function(n){p.Vn(n)}),p.Cn("aderror",function(n){p.Vn(n)}),p.Cn("loadedmetadata",function(n){p.v("loadedmetadata",n),p.yn(n),p.An()||p.In()}),p.Cn("loadeddata",function(n){p.v("loadeddata",n),p.yn(n)}),p.Cn("durationchange",function(n){p.v("durationchange",n),p.yn(n)}),p.Cn("seeking",function(n){p.v("seeking",n),p.yn(n),p.isSeekStarted||(p.isSeekStarted=!0,p.s&&p.s.reportPlaybackMetric(h.Constants.Playback.SEEK_STARTED,"CONVIVA")),p.rn&&p.C!==h.Constants.PlayerState.BUFFERING&&(p.v("Adjusting Conviva player state to: BUFFERING"),p.Nn(h.Constants.PlayerState.BUFFERING))}),p.Cn("seeked",function(n){p.v("seeked",n),p.yn(n),p.isSeekStarted=!1,p.s&&p.s.reportPlaybackMetric(h.Constants.Playback.SEEK_ENDED,"CONVIVA")}),p.Cn("progress",function(){}),p.Cn("stalled",function(){}),p.Cn("resize",function(){var n,i;p.An()&&p.wn(),"function"==typeof p.ln.videoWidth&&"function"==typeof p.ln.videoHeight&&(n=p.ln.videoWidth(),i=p.ln.videoHeight(),(!isNaN(n)&&0<n&&n!==p.f||!isNaN(i)&&0<i&&i!==p.c)&&(p.f=n,p.c=i,p.s.reportPlaybackMetric(h.Constants.Playback.RESOLUTION,n,i,"CONVIVA")))})},this.In=function(){if(!p.cn){for(var n,i=p.ln.textTracks(),o=0;o<i.length;o++)"segment-metadata"===i[o].label&&(n=i[o]);n&&(n.on("cuechange",p.On),p.cn=!0)}},this.mn=function(){for(var n,i=p.ln.textTracks(),o=0;o<i.length;o++)"segment-metadata"===i[o].label&&(n=i[o]);n&&(n.off("cuechange",p.On),p.cn=!1)},this.On=function(){var n=this.activeCues[0];if(n&&n.value&&n.value.bandwidth&&p.s&&p.C!==h.Constants.PlayerState.UNKNOWN){var i=0,o=0,t=n.value.bandwidth,a=p.ln;if(a){var e,v,r,s=a.tech(!0);if(s)if(s.vhs&&s.vhs.playlists&&s.vhs.playlists.media?(e=s.vhs.playlists,r=s.vhs.playlists.media()):s.hls&&s.hls.playlists&&s.hls.playlists.media&&(e=s.hls.playlists,r=s.hls.playlists.media()),r&&r.attributes){if(r.attributes.BANDWIDTH){var u=a.audioTracks();if(u&&0<u.length)for(var d=0;d<u.length;d++){var f=u[d];if(f.enabled){v=f;break}}}v&&r.attributes.AUDIO&&e&&e.master&&e.master.mediaGroups&&e.master.mediaGroups.AUDIO&&(!(r=e.master.mediaGroups.AUDIO[r.attributes.AUDIO])||(r=r[v.id])&&r.playlists&&r.playlists[0]&&((r=r.playlists[0].attributes)&&r.BANDWIDTH&&(o=r.BANDWIDTH)))}}i=t+o;i=Math.round(i/1e3);i!==p.sn&&(p.sn=i,p.s.reportPlaybackMetric(h.Constants.Playback.BITRATE,p.sn,"CONVIVA")),n.value.resolution&&n.value.resolution.width&&n.value.resolution.height&&(i=n.value.resolution.width,n=n.value.resolution.height,(!isNaN(i)&&0<i&&i!==p.f||!isNaN(n)&&0<n&&n!==p.c)&&(p.f=i,p.c=n,p.s.reportPlaybackMetric(h.Constants.Playback.RESOLUTION,i,n,"CONVIVA")))}},this.wn=function(){var n=0,i=0,o=0;if(p.s&&p.C!==h.Constants.PlayerState.UNKNOWN){var t=p.ln;if(t){var a,e,v,r=t.tech({IWillNotUseThisInPlugins:!0});if(r){if(r.vhs&&r.vhs.playlists&&r.vhs.playlists.media?(a=r.vhs.playlists,s=r.vhs.playlists.media()):r.hls&&r.hls.playlists&&r.hls.playlists.media&&(a=r.hls.playlists,s=r.hls.playlists.media()),s&&s.attributes){s.attributes.BANDWIDTH&&(o=s.attributes.BANDWIDTH);var s,u,d=t.audioTracks();if(d&&0<d.length)for(var f=0;f<d.length;f++){var c=d[f];if(c.enabled){e=c;break}}return e&&s.attributes.AUDIO&&a&&a.master&&a.master.mediaGroups&&a.master.mediaGroups.AUDIO&&(!(s=a.master.mediaGroups.AUDIO[s.attributes.AUDIO])||(u=s[e.id])&&u.playlists&&u.playlists[0]&&((C=u.playlists[0].attributes)&&C.BANDWIDTH&&(i=C.BANDWIDTH))),n=o+i,void((u=Math.round(n/1e3))!==p.sn&&(p.sn=u,p.s.reportPlaybackMetric(h.Constants.Playback.BITRATE,p.sn,"CONVIVA")))}var C=r.shakaPlayer_||r.shaka_||r.shakaPlayer;if(C&&"function"==typeof C.getStats){C=C.getStats();if(C&&C.streamBandwidth)return void((u=Math.round(C.streamBandwidth/1e3))!==p.sn&&(p.sn=u,p.s.reportPlaybackMetric(h.Constants.Playback.BITRATE,p.sn,"CONVIVA")))}r=r.hls_;if(r&&r.levels&&0<=r.currentLevel){var l=r.levels[r.currentLevel];if(l&&l.bitrate)return void((u=Math.round(l.bitrate/1e3))!==p.sn&&(p.sn=u,p.s.reportPlaybackMetric(h.Constants.Playback.BITRATE,p.sn,"CONVIVA")))}}t.mediaPlayer?v=t.mediaPlayer:t.dash&&t.dash.mediaPlayer&&(v=t.dash.mediaPlayer),v&&"function"==typeof v.getQualityFor&&"function"==typeof v.getBitrateInfoListFor&&(l=v.getQualityFor("audio"),t=v.getBitrateInfoListFor("audio"),void 0!==l&&t&&t[l]&&t[l].bitrate&&(i=t[l].bitrate),l=v.getQualityFor("video"),v=v.getBitrateInfoListFor("video"),n=i+(o=void 0!==l&&v&&v[l]&&v[l].bitrate?v[l].bitrate:o),(u=Math.round(n/1e3))!==p.sn&&(p.sn=u,p.s.reportPlaybackMetric(h.Constants.Playback.BITRATE,p.sn,"CONVIVA")))}}},this.getBufferLength=function(){var n=p.ln.buffered();if("number"!=typeof n)return-1;for(var i=0,o=0;o<n.length;o++){var t=n.start(o),a=n.end(o);t<=p.ln.currentTime()&&p.ln.currentTime()<a&&(i+=a-p.ln.currentTime())}return p.Mn=i,1e3*p.Mn},this.Pn=function(){for(var n=0;n<p.hn.length;n++){var i=p.hn[n];p.pn(i[0],i[1],i[2])}p.hn=[]},this.En=function(){p.ln&&(p.jn=p.ln.readyState(),0===p.ln.readyState()||p.ln.ended()?p.Nn(h.Constants.PlayerState.STOPPED):(p.ln.paused()||p.ln.seeking())&&p.Nn(h.Constants.PlayerState.PAUSED))},this.Nn=function(n){p.s&&(p.C=n,p.s.reportPlaybackMetric(h.Constants.Playback.PLAYER_STATE,p.C,"CONVIVA"),p._n(),p.bn=!0)},this.yn=function(n){if(p.s){var i,o=!0,t=!0;p.Bn&&((a=p.ln.playlist&&p.ln.playlist()&&0<p.ln.playlist().length?p.ln.playlist()[p.ln.playlist.currentItem()]:p.ln.mediainfo)&&(((i=a.custom_fields||a.customFields)&&(i.isLive||i.islive)||0<a.duration)&&(o=!1),0<a.duration&&(t=!1)),p.r&&void 0!==p.r.isLive&&(o=!1));var a={};if(p.ln&&p.ln.playlist&&"function"==typeof p.ln.playlist.currentItem&&(t||o)){var e,v=!1;switch(n.type){case"play":case"waiting":-1===p.ln.playlist.currentItem()&&(v=!0);break;case"playing":case"seeking":case"seeked":case"pause":case"loadedmetadata":case"loadeddata":case"durationChange":v=!0}v&&("function"==typeof p.ln.duration&&(e=p.ln.duration(),p.ln.duration()===1/0||isNaN(p.ln.duration())||(e=Math.round(p.ln.duration()))),e&&e!==p.un&&((p.un=e)===1/0?o&&(a[h.Constants.IS_LIVE]=h.Constants.StreamType.LIVE):0<e&&(t&&(a[h.Constants.DURATION]=e),o&&(a[h.Constants.IS_LIVE]=h.Constants.StreamType.VOD))))}"function"!=typeof p.ln.currentSource||!p.ln.currentSource().src||(o=p.ln.currentSource().src)!==p.dn&&(p.dn=o,a[h.Constants.STREAM_URL]=o),"{}"!==JSON.stringify(a)&&p.s.setContentInfo(a)}},this.xn=function(){var n;p.ln&&"function"==typeof p.ln.getVideoPlaybackQuality&&p.ln.getVideoPlaybackQuality()&&((n=p.ln.getVideoPlaybackQuality().droppedVideoFrames)&&0<n&&n!==p.fn&&(p.fn=n,p.s.reportPlaybackMetric(h.Constants.Playback.DROPPED_FRAMES_TOTAL,p.fn,"CONVIVA")))},this.Rn=function(){this.Sn=0,this.kn=0,this.Mn=0,this.qn=this.Tn.createTimer(this.Fn,100,"videojsProxy._poll()")},this.Fn=function(){p.s&&(p.s.getAdType()!==h.Constants.AdType.CLIENT_SIDE&&p.ln?(p.s.reportPlaybackMetric(h.Constants.Playback.PLAY_HEAD_TIME,1e3*p.ln.currentTime(),"CONVIVA"),p.s.reportPlaybackMetric(h.Constants.Playback.BUFFER_LENGTH,p.getBufferLength(),"CONVIVA"),p.Un(),p.Dn(),p.xn()):p.C!==h.Constants.PlayerState.UNKNOWN&&(p.C=h.Constants.PlayerState.UNKNOWN))},this.Un=function(){p.Sn=p.kn,p.kn=p.ln.currentTime();var n,i=Date.now();0<p.Gn&&i>p.Gn&&(n=(n=(n=p.kn-p.Sn)<0?0:n)/(i-p.Gn)*1e3,p.an.push(n)),p.Gn=i,p.an.length>Math.max(8,4)&&p.an.shift()},this.Dn=function(){var n=p.an.length;if(n>=Math.min(4,8)){for(var i=0,o=p.an.slice(),t=0;t<o.length;t++)i+=o[t];i/=n;var a=1,e=.25,v=p.ln.playbackRate();!isNaN(v)&&v!==1/0&&0<v&&(a*=v=p.An()&&v<.5?.5:v,e*=v),p.C!==h.Constants.PlayerState.PLAYING&&4<=n&&Math.abs(i-a)<e?p.ln.seeking()||(p.v("Adjusting Conviva player state to: PLAYING"),p.Nn(h.Constants.PlayerState.PLAYING)):8<=n&&0===i&&(p.ln.paused()?p.C!==h.Constants.PlayerState.PAUSED&&(p.v("Adjusting Conviva player state to: PAUSED"),p.Nn(h.Constants.PlayerState.PAUSED)):p.ln.seeking()||p.C!==h.Constants.PlayerState.BUFFERING&&(p.v("Adjusting Conviva player state to: BUFFERING"),p.Nn(h.Constants.PlayerState.BUFFERING)))}},this.Jn=function(){this.qn&&(this.qn(),this.qn=null)},this._n=function(){p.an=[],p.Sn=-1,p.Gn=0},this.Hn=function(){p.vn=0,p.en=0},this.Vn=function(n){p.v("error",n),p.ln&&p.ln.error()&&!p.Bn&&(n="Error Type: "+n.type+", Error Message: "+p.ln.error().message+", Error Code: "+p.ln.error().code,p.s.reportPlaybackError(n,h.Constants.ErrorSeverity.FATAL))},this.v=function(n){this.Bn?this.Kn(n):this.Kn.log(n,h.SystemSettings.LogLevel.DEBUG)},this.L=function(n,i){if(!n)throw new Error("bcVideojsProxy: player argument cannot be null.");p.ln=n,p.s=i,p.v("bcVideojsProxy.update()"),0===p.hn.length&&p.gn(),p._n(),p.Hn(),p.Jn(),p.Rn(),p.f=-1,p.c=-1,p.C=h.Constants.PlayerState.UNKNOWN,p.sn=0,p.un=-1,p.dn="",p.fn=null,p.En();n={};n[h.Constants.MODULE_NAME]="BC",n[h.Constants.MODULE_VERSION]="4.3.3",p.s.setContentInfo(n),this.An()||this.In(),p.An()&&(p.wn(),"function"==typeof p.ln.videoWidth&&"function"==typeof p.ln.videoHeight&&(i=p.ln.videoWidth(),n=p.ln.videoHeight(),(!isNaN(i)&&0<i&&i!==p.f||!isNaN(n)&&0<n&&n!==p.c)&&(p.f=i,p.c=n,p.s.reportPlaybackMetric(h.Constants.Playback.RESOLUTION,i,n,"CONVIVA"))))},this.An=function(){return/apple/i.test(navigator.vendor)},function(n,i,o,t,a,e){if(!n)throw new Error("videojsProxy: videoElement argument cannot be null.");var v={};this.Bn=!1,this.ln=n,this.s=o,this.Tn=new t.Impl.Html5Timer,i?(this.Kn=i.buildLogger(),this.Kn.setModuleName("videojsProxy"),v[t.Constants.MODULE_NAME]="Video JS",(i={})[t.Constants.FRAMEWORK_NAME]="Video JS","undefined"!=typeof videojs&&(i[t.Constants.FRAMEWORK_VERSION]=videojs.VERSION),this.s.setPlayerInfo(i)):(this.Kn=a,this.r=e,v[t.Constants.MODULE_NAME]="BC",this.Bn=!0),v[t.Constants.MODULE_VERSION]="4.3.3",this.v("videojsProxy._constr()"),this.hn=[],this.gn(),this._n(),this.Hn(),this.Rn(),this.En(),this.s.setContentInfo(v),this.An()||this.In(),p.An()&&(p.wn(),"function"==typeof p.ln.videoWidth&&"function"==typeof p.ln.videoHeight&&(e=p.ln.videoWidth(),v=p.ln.videoHeight(),(!isNaN(e)&&0<e&&e!==p.f||!isNaN(v)&&0<v&&v!==p.c)&&(p.f=e,p.c=v,p.s.reportPlaybackMetric(t.Constants.Playback.RESOLUTION,e,v,"CONVIVA"))))}.apply(this,arguments),this.cleanup=function(){this.v("videojsProxy.cleanup()"),this.Jn(),this.Pn(),this.An()||this.mn(),this.ln=null,p.s=null,p.f=-1,p.c=-1,p.C=h.Constants.PlayerState.UNKNOWN,p.sn=0,p.un=-1,p.dn="",p.fn=null,p.cn=!1}};"undefined"!=typeof ConvivaModule&&(ConvivaModule.Impl=ConvivaModule.Impl||{},ConvivaModule.Impl.VideojsProxy=videojsProxy);